ANSI-C/cC++ Compiler for HC08 V-5.0.32 Build 9279, Oct  7 2009

    1:  /**
    2:    ******************************************************************************
    3:    * proj    firmware startup project
    4:    * file    timer.c
    5:    * ver     1.0
    6:    * brief   This is a template file for all C files.
    7:    ------------------------------------------------------------------------------
    8:    * 2011.11.20  created by taoyu@bakai.com
    9:    */ 
   10:  
   11:  /* File Id -------------------------------------------------------------------*/
   12:  #define _TIMER_C_ 0x42
   13:  #define FILE_No _TIMER_C_
   14:  
   15:  /* Includes ------------------------------------------------------------------*/
   16:  #include  "timer.h"  /* mandotary */
   17:  
   18:  /* Private Macros & Defines --------------------------------------------------*/
   19:  
   20:  /* Private typedefs ----------------------------------------------------------*/
   21:  
   22:  /* Private consts ------------------------------------------------------------*/
   23:  
   24:  /* Private variables ---------------------------------------------------------*/
   25:  
   26:  unsigned long  timer_tick = 0;
   27:  
   28:  /* Private function prototypes -----------------------------------------------*/
   29:  
   30:  /* Global consts -------------------------------------------------------------*/
   31:  
   32:  /* Global variables ----------------------------------------------------------*/
   33:  
   34:  /* Functions -----------------------------------------------------------------*/
   35:  
   36:  /**
   37:    * bref    timer interrupt hander, called by timer isr
   38:    * param   none
   39:    * retval  none
   40:    */
   41:  
   42:  void  timer_tickup(void)
   43:  {

Function: timer_tickup
Source  : C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\04 Modules\timer.c
Options : -AddIncl../preinc.h -Cs08 -D__NO_FLOAT__ -Env"GENPATH=C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\bin;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\src;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\lib;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\src;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\06 Platform;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\04 Modules;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\Sources;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\07 Application;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\05 Devices;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"LIBPATH=D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"OBJPATH=C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\bin" -Env"TEXTPATH=C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\bin" -Lasm=%n.lst -Ms -ObjN="C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\mc9s08dz60_Data\Standard\ObjectCode\timer.c.o"

   44:    timer_tick ++;
  0000 450000   [3]             LDHX  @timer_tick
  0003 cd0000   [6]             JSR   _LINC
  0006 cd0000   [6]             JSR   _POP32
   45:  }
  0009 81       [6]             RTS   
   46:  
   47:  /**
   48:    * bref    start a timer
   49:    * param   pointer of a timer
   50:    * retval  none
   51:    */
   52:  
   53:  void  timer_start(timer_t* timer)
   54:  {

Function: timer_start
Source  : C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\04 Modules\timer.c
Options : -AddIncl../preinc.h -Cs08 -D__NO_FLOAT__ -Env"GENPATH=C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\bin;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\src;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\lib;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\src;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\06 Platform;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\04 Modules;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\Sources;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\07 Application;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\05 Devices;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"LIBPATH=D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"OBJPATH=C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\bin" -Env"TEXTPATH=C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\bin" -Lasm=%n.lst -Ms -ObjN="C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\mc9s08dz60_Data\Standard\ObjectCode\timer.c.o"

   55:    timer->start_tick = timer_tick;
  0000 af04     [2]             AIX   #4
  0002 89       [2]             PSHX  
  0003 8b       [2]             PSHH  
  0004 450000   [3]             LDHX  @timer_tick
  0007 a604     [2]             LDA   #4
  0009 cd0000   [6]             JSR   _COPY
   56:  }
  000c 81       [6]             RTS   
   57:  
   58:  /**
   59:    * bref    check if time out
   60:    * param   pointer of a timer
   61:    * retval  1 timeout, 0 not timeout
   62:    */
   63:  
   64:  int   timer_timeout(timer_t* timer)
   65:  {

Function: timer_timeout
Source  : C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\04 Modules\timer.c
Options : -AddIncl../preinc.h -Cs08 -D__NO_FLOAT__ -Env"GENPATH=C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\bin;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\src;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\lib;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\src;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\06 Platform;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\04 Modules;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\Sources;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\07 Application;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\05 Devices;C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"LIBPATH=D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"OBJPATH=C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\bin" -Env"TEXTPATH=C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\bin" -Lasm=%n.lst -Ms -ObjN="C:\Users\Administrator\Desktop\新建文件夹 (2)\奥泰10V3T\02 CodeWarrior\mc9s08dz60_Data\Standard\ObjectCode\timer.c.o"

  0000 89       [2]             PSHX  
  0001 8b       [2]             PSHH  
  0002 a7f5     [2]             AIS   #-11
   66:    /* save now tick in case new interrupt occurs */
   67:    unsigned long now_tick = timer_tick;
  0004 320002   [5]             LDHX  timer_tick:2
  0007 9eff06   [5]             STHX  6,SP
  000a 320000   [5]             LDHX  timer_tick
  000d 9eff04   [5]             STHX  4,SP
   68:    /* get passed ticks */
   69:    unsigned long passed_ticks = now_tick - timer->start_tick;
  0010 9efe0c   [5]             LDHX  12,SP
  0013 af04     [2]             AIX   #4
  0015 89       [2]             PSHX  
  0016 8b       [2]             PSHH  
  0017 95       [2]             TSX   
  0018 af05     [2]             AIX   #5
  001a cd0000   [6]             JSR   _LSUB
  001d af04     [2]             AIX   #4
  001f cd0000   [6]             JSR   _POP32
   70:    /* not time out */
   71:    if( passed_ticks < timer->cycle_ticks ) return 0;
  0022 95       [2]             TSX   
  0023 af07     [2]             AIX   #7
  0025 89       [2]             PSHX  
  0026 8b       [2]             PSHH  
  0027 9efe0e   [5]             LDHX  14,SP
  002a 9eff04   [5]             STHX  4,SP
  002d cd0000   [6]             JSR   _LCMP
  0030 2304     [3]             BLS   L36 ;abs = 0036
  0032 8c       [1]             CLRH  
  0033 5f       [1]             CLRX  
  0034 2021     [3]             BRA   L57 ;abs = 0057
  0036          L36:    
   72:    /* new start tick for next cyclec */
   73:    timer->start_tick += timer->cycle_ticks;
  0036 9efe02   [5]             LDHX  2,SP
  0039 af04     [2]             AIX   #4
  003b 89       [2]             PSHX  
  003c 8b       [2]             PSHH  
  003d 9f       [1]             TXA   
  003e 87       [2]             PSHA  
  003f 8b       [2]             PSHH  
  0040 86       [3]             PULA  
  0041 95       [2]             TSX   
  0042 e703     [3]             STA   3,X
  0044 86       [3]             PULA  
  0045 9efe0e   [5]             LDHX  14,SP
  0048 cd0000   [6]             JSR   _LADD
  004b 95       [2]             TSX   
  004c ee04     [3]             LDX   4,X
  004e 89       [2]             PSHX  
  004f 8a       [3]             PULH  
  0050 97       [1]             TAX   
  0051 cd0000   [6]             JSR   _POP32
   74:    /* ok */
   75:    return  1;
  0054 ae01     [2]             LDX   #1
  0056 8c       [1]             CLRH  
  0057          L57:    
   76:  }
  0057 a70d     [2]             AIS   #13
  0059 81       [6]             RTS   
   77:  
   78:  
