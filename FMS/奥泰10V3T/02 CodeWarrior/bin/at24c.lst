ANSI-C/cC++ Compiler for HC08 V-5.0.32 Build 9279, Oct  7 2009

    1:  /**
    2:    ******************************************************************************
    3:    * proj    firmware startup project
    4:    * file    template.c
    5:    * ver     1.0
    6:    * brief   This is a template file for all C files.
    7:    ------------------------------------------------------------------------------
    8:    * 2012.02 created by taoyu@bakai.com
    9:    */ 
   10:  
   11:  /* File Id -------------------------------------------------------------------*/
   12:  #define _AT24C_C_ 0x51
   13:  #define FILE_No _AT24C_C_
   14:  
   15:  /* Includes ------------------------------------------------------------------*/
   16:  #include  "at24c.h"  /* mandotary */
   17:  #include  "mcu.h"     /* iic, xfer */
   18:  
   19:  /* Private Macros & Defines --------------------------------------------------*/
   20:  
   21:  #ifndef DEBUG_DEV_AT24C
   22:  #define DEBUG_DEV_AT24C 0
   23:  #endif
   24:  
   25:  #if DEBUG_DEV_AT24C
   26:  #define AT24C_PRINTF  PRINTF
   27:  #else
   28:  #define AT24C_PRINTF  empty_printf
   29:  #endif
   30:  
   31:  #define DEVICE_ADDRESS  0x50  /* 7 bits */
   32:  
   33:  /* Private typedefs ----------------------------------------------------------*/
   34:  
   35:  typedef union
   36:  {
   37:    struct{    
   38:      volatile unsigned char wa1;
   39:      volatile unsigned char wa2;
   40:      volatile unsigned char data[128];
   41:    }grouped;
   42:    unsigned char  buffer[2+128];
   43:  }
   44:  at24c_txbuf_t;
   45:  
   46:  typedef struct
   47:  {
   48:    at24c_txbuf_t  txbuf;
   49:    xfer_t  xfer;
   50:  }
   51:  at24c_t;
   52:  
   53:  /* Private consts ------------------------------------------------------------*/
   54:  
   55:  /* Private variables ---------------------------------------------------------*/
   56:  
   57:  at24c_t at24c;
   58:  
   59:  /* Private function prototypes -----------------------------------------------*/
   60:  
   61:  /* Global consts -------------------------------------------------------------*/
   62:  
   63:  /* Global variables ----------------------------------------------------------*/
   64:  
   65:  /* Functions -----------------------------------------------------------------*/
   66:  
   67:  /**
   68:    * bref    template function
   69:    * param   none
   70:    * retval  none
   71:    */
   72:  
   73:  int at24c_init(void) {

Function: at24c_init
Source  : C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices\at24c.c
Options : -AddIncl../preinc.h -Cs08 -D__NO_FLOAT__ -Env"GENPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\src;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\lib;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\src;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\06 Platform;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\04 Modules;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\Sources;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\07 Application;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"LIBPATH=D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"OBJPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Env"TEXTPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Lasm=%n.lst -Ms -ObjN="C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\mc9s08dz60_Data\Standard\ObjectCode\at24c.c.o" -WmsgSd1106

   74:    return iic_init();
  0000 cc0000   [4]             JMP   iic_init
   75:  }
   76:  
   77:  int at24c_reset(void){

Function: at24c_reset
Source  : C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices\at24c.c
Options : -AddIncl../preinc.h -Cs08 -D__NO_FLOAT__ -Env"GENPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\src;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\lib;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\src;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\06 Platform;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\04 Modules;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\Sources;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\07 Application;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"LIBPATH=D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"OBJPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Env"TEXTPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Lasm=%n.lst -Ms -ObjN="C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\mc9s08dz60_Data\Standard\ObjectCode\at24c.c.o" -WmsgSd1106

   78:    return iic_reset();
  0000 cc0000   [4]             JMP   iic_reset
   79:  }
   80:  
   81:  int at24c_write_page(unsigned short page, unsigned char * buffer){

Function: at24c_write_page
Source  : C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices\at24c.c
Options : -AddIncl../preinc.h -Cs08 -D__NO_FLOAT__ -Env"GENPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\src;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\lib;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\src;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\06 Platform;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\04 Modules;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\Sources;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\07 Application;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"LIBPATH=D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"OBJPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Env"TEXTPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Lasm=%n.lst -Ms -ObjN="C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\mc9s08dz60_Data\Standard\ObjectCode\at24c.c.o" -WmsgSd1106

  0000 89       [2]             PSHX  
  0001 8b       [2]             PSHH  
  0002 8b       [2]             PSHH  
   82:  
   83:    unsigned char i;
   84:  
   85:    if( page>=512 ) return -1;
  0003 9efe06   [5]             LDHX  6,SP
  0006 650200   [3]             CPHX  #512
  0009 2505     [3]             BCS   L10 ;abs = 0010
  000b 45ffff   [3]             LDHX  #-1
  000e 2067     [3]             BRA   L77 ;abs = 0077
  0010          L10:    
   86:  
   87:    /* prepare data */
   88:    page *= 128;
  0010 95       [2]             TSX   
  0011 a607     [2]             LDA   #7
  0013          L13:    
  0013 6806     [5]             LSL   6,X
  0015 6905     [5]             ROL   5,X
  0017 4bfa     [4]             DBNZA L13 ;abs = 0013
   89:    at24c.txbuf.grouped.wa1 = page/256;
  0019 e605     [3]             LDA   5,X
  001b c70000   [4]             STA   at24c
   90:    at24c.txbuf.grouped.wa2 = page%256;
  001e e606     [3]             LDA   6,X
  0020 c70001   [4]             STA   at24c:1
   91:    for(i=0;i<128;i++) at24c.txbuf.grouped.data[i] = buffer[i];
  0023 7f       [4]             CLR   ,X
  0024          L24:    
  0024 f6       [3]             LDA   ,X
  0025 eb02     [3]             ADD   2,X
  0027 87       [2]             PSHA  
  0028 4f       [1]             CLRA  
  0029 e901     [3]             ADC   1,X
  002b 87       [2]             PSHA  
  002c 8a       [3]             PULH  
  002d 88       [3]             PULX  
  002e fe       [3]             LDX   ,X
  002f 9f       [1]             TXA   
  0030 95       [2]             TSX   
  0031 fe       [3]             LDX   ,X
  0032 8c       [1]             CLRH  
  0033 d70002   [4]             STA   @at24c:2,X
  0036 95       [2]             TSX   
  0037 7c       [4]             INC   ,X
  0038 f6       [3]             LDA   ,X
  0039 a180     [2]             CMP   #-128
  003b 25e7     [3]             BCS   L24 ;abs = 0024
   92:    at24c.xfer.devadd = DEVICE_ADDRESS;
  003d a650     [2]             LDA   #80
  003f c70082   [4]             STA   at24c:130
   93:    at24c.xfer.txcnt = 2+128;
  0042 ae82     [2]             LDX   #-126
  0044 8c       [1]             CLRH  
  0045 960087   [5]             STHX  at24c:135
   94:    at24c.xfer.txbuf = at24c.txbuf.buffer;
  0048 450000   [3]             LDHX  @at24c
  004b 960083   [5]             STHX  at24c:131
   95:    at24c.xfer.rxmax = 0;
  004e 5f       [1]             CLRX  
  004f 8c       [1]             CLRH  
  0050 960089   [5]             STHX  at24c:137
   96:    at24c.xfer.rxbuf = 0;
  0053 960085   [5]             STHX  at24c:133
   97:    
   98:    /* release wp and delay 1 ms */
   99:    (void)pin_low(PN_EEPROM_WP);
  0056 ae05     [2]             LDX   #5
  0058 cd0000   [6]             JSR   pin_low
  100:    delay_ms(1);
  005b ae01     [2]             LDX   #1
  005d 8c       [1]             CLRH  
  005e cd0000   [6]             JSR   delay_ms
  101:    
  102:    /* transfer iic data */
  103:    (void)iic_xfer(&at24c.xfer);
  0061 450082   [3]             LDHX  @at24c:130
  0064 cd0000   [6]             JSR   iic_xfer
  104:    
  105:    /* wait until program done, should done in 5 ms */
  106:    delay_ms(10);
  0067 ae0a     [2]             LDX   #10
  0069 8c       [1]             CLRH  
  006a cd0000   [6]             JSR   delay_ms
  107:  
  108:    /* set wp again */
  109:    (void)pin_high(PN_EEPROM_WP);
  006d ae05     [2]             LDX   #5
  006f 8c       [1]             CLRH  
  0070 cd0000   [6]             JSR   pin_high
  110:    
  111:    /* done */
  112:    return  1;
  0073 a601     [2]             LDA   #1
  0075 8c       [1]             CLRH  
  0076 97       [1]             TAX   
  0077          L77:    
  113:  
  114:  }
  0077 a703     [2]             AIS   #3
  0079 81       [6]             RTS   
  115:  
  116:  int at24c_read_page(unsigned short page, unsigned char * buffer){

Function: at24c_read_page
Source  : C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices\at24c.c
Options : -AddIncl../preinc.h -Cs08 -D__NO_FLOAT__ -Env"GENPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\src;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\lib;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\src;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\06 Platform;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\04 Modules;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\Sources;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\07 Application;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"LIBPATH=D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"OBJPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Env"TEXTPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Lasm=%n.lst -Ms -ObjN="C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\mc9s08dz60_Data\Standard\ObjectCode\at24c.c.o" -WmsgSd1106

  0000 89       [2]             PSHX  
  0001 8b       [2]             PSHH  
  117:  
  118:    if( page>=512 ) return -1;
  0002 9efe05   [5]             LDHX  5,SP
  0005 650200   [3]             CPHX  #512
  0008 2505     [3]             BCS   LF ;abs = 000f
  000a 45ffff   [3]             LDHX  #-1
  000d 2039     [3]             BRA   L48 ;abs = 0048
  000f          LF:     
  119:  
  120:    /* prepare data */
  121:    page *= 128;
  000f 95       [2]             TSX   
  0010 a607     [2]             LDA   #7
  0012          L12:    
  0012 6805     [5]             LSL   5,X
  0014 6904     [5]             ROL   4,X
  0016 4bfa     [4]             DBNZA L12 ;abs = 0012
  122:    at24c.txbuf.grouped.wa1 = page/256;
  0018 e604     [3]             LDA   4,X
  001a c70000   [4]             STA   at24c
  123:    at24c.txbuf.grouped.wa2 = page%256;
  001d e605     [3]             LDA   5,X
  001f c70001   [4]             STA   at24c:1
  124:    at24c.xfer.devadd = DEVICE_ADDRESS;
  0022 a650     [2]             LDA   #80
  0024 c70082   [4]             STA   at24c:130
  125:    at24c.xfer.txcnt = 2;
  0027 ae02     [2]             LDX   #2
  0029 8c       [1]             CLRH  
  002a 960087   [5]             STHX  at24c:135
  126:    at24c.xfer.txbuf = at24c.txbuf.buffer;
  002d 450000   [3]             LDHX  @at24c
  0030 960083   [5]             STHX  at24c:131
  127:    at24c.xfer.rxmax = 128;
  0033 ae80     [2]             LDX   #-128
  0035 8c       [1]             CLRH  
  0036 960089   [5]             STHX  at24c:137
  128:    at24c.xfer.rxbuf = buffer;
  0039 9efe01   [5]             LDHX  1,SP
  003c 960085   [5]             STHX  at24c:133
  129:  
  130:    /* transfer iic data */
  131:    (void)iic_xfer(&at24c.xfer);
  003f 450082   [3]             LDHX  @at24c:130
  0042 cd0000   [6]             JSR   iic_xfer
  132:  
  133:    /* done */
  134:    return  1;
  0045 ae01     [2]             LDX   #1
  0047 8c       [1]             CLRH  
  0048          L48:    
  135:  
  136:  }
  0048 a702     [2]             AIS   #2
  004a 81       [6]             RTS   
  137:  
  138:  int at24c_read(unsigned short addr, unsigned char * buf, unsigned short len)
  139:  {

Function: at24c_read
Source  : C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices\at24c.c
Options : -AddIncl../preinc.h -Cs08 -D__NO_FLOAT__ -Env"GENPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\src;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\lib;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\src;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\06 Platform;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\04 Modules;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\Sources;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\07 Application;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"LIBPATH=D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"OBJPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Env"TEXTPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Lasm=%n.lst -Ms -ObjN="C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\mc9s08dz60_Data\Standard\ObjectCode\at24c.c.o" -WmsgSd1106

  0000 a7fc     [2]             AIS   #-4
  140:  
  141:    AT24C_PRINTF("at24c read: %u, %Xh, %u\r\n", addr, (unsigned short)buf,len);
  0002 89       [2]             PSHX  
  0003 8b       [2]             PSHH  
  0004 9eff03   [5]             STHX  3,SP
  0007 9efe09   [5]             LDHX  9,SP
  000a 89       [2]             PSHX  
  000b 8b       [2]             PSHH  
  000c 9eff07   [5]             STHX  7,SP
  000f 9efe0d   [5]             LDHX  13,SP
  0012 89       [2]             PSHX  
  0013 8b       [2]             PSHH  
  0014 450000   [3]             LDHX  @"at24c read: %u, %Xh, %u\015\012"
  0017 89       [2]             PSHX  
  0018 8b       [2]             PSHH  
  0019 cd0000   [6]             JSR   empty_printf
  001c a708     [2]             AIS   #8
  142:  
  143:    /* prepare data */
  144:    at24c.txbuf.grouped.wa1 = (unsigned char)(addr>>8);
  001e 95       [2]             TSX   
  001f e608     [3]             LDA   8,X
  0021 c70000   [4]             STA   at24c
  145:    at24c.txbuf.grouped.wa2 = (unsigned char)addr;
  0024 e609     [3]             LDA   9,X
  0026 c70001   [4]             STA   at24c:1
  146:    at24c.xfer.devadd = DEVICE_ADDRESS;
  0029 a650     [2]             LDA   #80
  002b c70082   [4]             STA   at24c:130
  147:    at24c.xfer.txcnt = 2;
  002e ae02     [2]             LDX   #2
  0030 8c       [1]             CLRH  
  0031 960087   [5]             STHX  at24c:135
  148:    at24c.xfer.txbuf = at24c.txbuf.buffer;
  0034 450000   [3]             LDHX  @at24c
  0037 960083   [5]             STHX  at24c:131
  149:    at24c.xfer.rxbuf = buf;
  003a 9efe03   [5]             LDHX  3,SP
  003d 960085   [5]             STHX  at24c:133
  150:    at24c.xfer.rxmax = len;
  0040 9efe01   [5]             LDHX  1,SP
  0043 960089   [5]             STHX  at24c:137
  151:    
  152:    /* transfer iic data */
  153:    (void)iic_xfer(&at24c.xfer);
  0046 450082   [3]             LDHX  @at24c:130
  0049 cd0000   [6]             JSR   iic_xfer
  154:    
  155:    /* done */
  156:    return 1;
  004c ae01     [2]             LDX   #1
  004e 8c       [1]             CLRH  
  157:  
  158:  }
  004f a704     [2]             AIS   #4
  0051 81       [6]             RTS   
  159:  
  160:  static int at24c_write_in_page(unsigned short addr, unsigned char * buf, unsigned short len)
  161:  {

Function: at24c_write_in_page
Source  : C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices\at24c.c
Options : -AddIncl../preinc.h -Cs08 -D__NO_FLOAT__ -Env"GENPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\src;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\lib;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\src;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\06 Platform;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\04 Modules;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\Sources;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\07 Application;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"LIBPATH=D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"OBJPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Env"TEXTPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Lasm=%n.lst -Ms -ObjN="C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\mc9s08dz60_Data\Standard\ObjectCode\at24c.c.o" -WmsgSd1106

  0000 89       [2]             PSHX  
  0001 8b       [2]             PSHH  
  0002 8b       [2]             PSHH  
  162:  
  163:    unsigned char i;
  164:  
  165:    AT24C_PRINTF("at24c wip: %u, %Xh, %u\r\n", addr, (unsigned short)buf,len);
  0003 89       [2]             PSHX  
  0004 8b       [2]             PSHH  
  0005 9efe08   [5]             LDHX  8,SP
  0008 89       [2]             PSHX  
  0009 8b       [2]             PSHH  
  000a 9efe0c   [5]             LDHX  12,SP
  000d 89       [2]             PSHX  
  000e 8b       [2]             PSHH  
  000f 450000   [3]             LDHX  @"at24c wip: %u, %Xh, %u\015\012"
  0012 89       [2]             PSHX  
  0013 8b       [2]             PSHH  
  0014 cd0000   [6]             JSR   empty_printf
  0017 a708     [2]             AIS   #8
  166:  
  167:    /* prepare data */
  168:    at24c.txbuf.grouped.wa1 = (unsigned char)(addr>>8);
  0019 95       [2]             TSX   
  001a e607     [3]             LDA   7,X
  001c c70000   [4]             STA   at24c
  169:    at24c.txbuf.grouped.wa2 = (unsigned char)addr;
  001f e608     [3]             LDA   8,X
  0021 c70001   [4]             STA   at24c:1
  170:    for(i=0;i<len;i++) at24c.txbuf.grouped.data[i] = buf[i];
  0024 7f       [4]             CLR   ,X
  0025 2015     [3]             BRA   L3C ;abs = 003c
  0027          L27:    
  0027 95       [2]             TSX   
  0028 f6       [3]             LDA   ,X
  0029 eb06     [3]             ADD   6,X
  002b 87       [2]             PSHA  
  002c 4f       [1]             CLRA  
  002d e905     [3]             ADC   5,X
  002f 87       [2]             PSHA  
  0030 8a       [3]             PULH  
  0031 88       [3]             PULX  
  0032 fe       [3]             LDX   ,X
  0033 9f       [1]             TXA   
  0034 95       [2]             TSX   
  0035 fe       [3]             LDX   ,X
  0036 8c       [1]             CLRH  
  0037 d70002   [4]             STA   @at24c:2,X
  003a 95       [2]             TSX   
  003b 7c       [4]             INC   ,X
  003c          L3C:    
  003c fe       [3]             LDX   ,X
  003d 8c       [1]             CLRH  
  003e 9ef302   [6]             CPHX  2,SP
  0041 25e4     [3]             BCS   L27 ;abs = 0027
  171:    at24c.xfer.devadd = DEVICE_ADDRESS;
  0043 a650     [2]             LDA   #80
  0045 c70082   [4]             STA   at24c:130
  172:    at24c.xfer.txcnt = 2+len;
  0048 9efe02   [5]             LDHX  2,SP
  004b af02     [2]             AIX   #2
  004d 960087   [5]             STHX  at24c:135
  173:    at24c.xfer.txbuf = at24c.txbuf.buffer;
  0050 450000   [3]             LDHX  @at24c
  0053 960083   [5]             STHX  at24c:131
  174:    at24c.xfer.rxmax = 0;
  0056 5f       [1]             CLRX  
  0057 8c       [1]             CLRH  
  0058 960089   [5]             STHX  at24c:137
  175:    at24c.xfer.rxbuf = 0;
  005b 960085   [5]             STHX  at24c:133
  176:    
  177:    /* release wp and delay 1 ms */
  178:    (void)pin_low(PN_EEPROM_WP);
  005e ae05     [2]             LDX   #5
  0060 cd0000   [6]             JSR   pin_low
  179:    delay_ms(10);
  0063 ae0a     [2]             LDX   #10
  0065 8c       [1]             CLRH  
  0066 cd0000   [6]             JSR   delay_ms
  180:    
  181:    /* transfer iic data */
  182:    (void)iic_xfer(&at24c.xfer);
  0069 450082   [3]             LDHX  @at24c:130
  006c cd0000   [6]             JSR   iic_xfer
  183:    
  184:    /* wait until program done, should done in 5 ms */
  185:    delay_ms(100);
  006f ae64     [2]             LDX   #100
  0071 8c       [1]             CLRH  
  0072 cd0000   [6]             JSR   delay_ms
  186:  
  187:    /* set wp again */
  188:    (void)pin_high(PN_EEPROM_WP);
  0075 ae05     [2]             LDX   #5
  0077 8c       [1]             CLRH  
  0078 cd0000   [6]             JSR   pin_high
  189:    
  190:    /* done */
  191:    return  len;
  007b 9efe02   [5]             LDHX  2,SP
  192:  
  193:  }
  007e a703     [2]             AIS   #3
  0080 81       [6]             RTS   
  194:  
  195:  int at24c_write(unsigned short addr, unsigned char * buf, unsigned short len)
  196:  {

Function: at24c_write
Source  : C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices\at24c.c
Options : -AddIncl../preinc.h -Cs08 -D__NO_FLOAT__ -Env"GENPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\src;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\lib;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\src;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\06 Platform;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\04 Modules;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\Sources;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\07 Application;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\05 Devices;C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"LIBPATH=D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\hc08c\device\asm_include;D:\Program Files\Freescale\CodeWarrior for Microcontrollers V6.3\lib\HC08c\include" -Env"OBJPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Env"TEXTPATH=C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\bin" -Lasm=%n.lst -Ms -ObjN="C:\Users\Administrator\Desktop\Fms\FMS\°ÂÌ©10V3T\02 CodeWarrior\mc9s08dz60_Data\Standard\ObjectCode\at24c.c.o" -WmsgSd1106

  0000 89       [2]             PSHX  
  0001 8b       [2]             PSHH  
  0002 a7fc     [2]             AIS   #-4
  197:  
  198:    unsigned short txcnt;
  199:    
  200:    txcnt = ((addr&0xFF80)+0x0080)-addr;
  0004 95       [2]             TSX   
  0005 e60b     [3]             LDA   11,X
  0007 a480     [2]             AND   #-128
  0009 ab80     [2]             ADD   #-128
  000b 87       [2]             PSHA  
  000c e60a     [3]             LDA   10,X
  000e a900     [2]             ADC   #0
  0010 87       [2]             PSHA  
  0011 95       [2]             TSX   
  0012 e601     [3]             LDA   1,X
  0014 e00d     [3]             SUB   13,X
  0016 e701     [3]             STA   1,X
  0018 86       [3]             PULA  
  0019 e20c     [3]             SBC   12,X
  001b 87       [2]             PSHA  
  001c 8a       [3]             PULH  
  001d 88       [3]             PULX  
  201:  
  202:    /* each page */
  203:    while( txcnt<len ){
  001e 203a     [3]             BRA   L5A ;abs = 005a
  0020          L20:    
  204:      (void)at24c_write_in_page(addr,buf,txcnt);
  0020 9efe0b   [5]             LDHX  11,SP
  0023 89       [2]             PSHX  
  0024 8b       [2]             PSHH  
  0025 9efe0b   [5]             LDHX  11,SP
  0028 89       [2]             PSHX  
  0029 8b       [2]             PSHH  
  002a 9efe07   [5]             LDHX  7,SP
  002d cd0000   [6]             JSR   at24c_write_in_page
  0030 a704     [2]             AIS   #4
  205:      addr += txcnt;
  0032 95       [2]             TSX   
  0033 e603     [3]             LDA   3,X
  0035 eb0b     [3]             ADD   11,X
  0037 e70b     [3]             STA   11,X
  0039 e60a     [3]             LDA   10,X
  003b e902     [3]             ADC   2,X
  003d e70a     [3]             STA   10,X
  206:      buf += txcnt;
  003f e603     [3]             LDA   3,X
  0041 eb09     [3]             ADD   9,X
  0043 e709     [3]             STA   9,X
  0045 e602     [3]             LDA   2,X
  0047 e908     [3]             ADC   8,X
  0049 e708     [3]             STA   8,X
  207:      len -= txcnt;
  004b e605     [3]             LDA   5,X
  004d e003     [3]             SUB   3,X
  004f e705     [3]             STA   5,X
  0051 e604     [3]             LDA   4,X
  0053 e202     [3]             SBC   2,X
  0055 e704     [3]             STA   4,X
  208:      txcnt = 128;
  0057 ae80     [2]             LDX   #-128
  0059 8c       [1]             CLRH  
  005a          L5A:    
  005a 9eff03   [5]             STHX  3,SP
  005d 9efe05   [5]             LDHX  5,SP
  0060 9ef303   [6]             CPHX  3,SP
  0063 22bb     [3]             BHI   L20 ;abs = 0020
  209:  
  210:    }
  211:  
  212:    /* last page */
  213:    (void)at24c_write_in_page(addr,buf,len);
  0065 9eff01   [5]             STHX  1,SP
  0068 9efe0b   [5]             LDHX  11,SP
  006b 89       [2]             PSHX  
  006c 8b       [2]             PSHH  
  006d 9efe0b   [5]             LDHX  11,SP
  0070 89       [2]             PSHX  
  0071 8b       [2]             PSHH  
  0072 9efe05   [5]             LDHX  5,SP
  0075 cd0000   [6]             JSR   at24c_write_in_page
  0078 a704     [2]             AIS   #4
  214:  
  215:    /* done */
  216:    return 1;
  007a ae01     [2]             LDX   #1
  007c 8c       [1]             CLRH  
  217:  
  218:  }
  007d a706     [2]             AIS   #6
  007f 81       [6]             RTS   
  219:  
